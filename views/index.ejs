<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Chapters</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div id="maincontent">  
            <h2>Total Chapters Read: <%= totalChapters %></h2>
            <h2>Total Bible Completions: <%= completions %></h2>
<h3>Progress toward the next completion: <%= progressPercentage %> %</h3>
<h4>Chapters remaining for next completion: <%= totalBibleChapters - remainingChaptersForNextCompletion %> of <%= totalBibleChapters %></h4>
            <a href="/unread-chapters">What needs to be read?</a>
            <a href="#" id="openBibleProgress">View Bible Progress</a>
            <% if (isLoggedIn) { %>
                <h2>Chapter Counts by Reader</h2>
                <table border="1">
                    <thead>
                        <tr>
                            <th>Reader Name</th>
                            <th>Total Chapters</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% readerCounts.forEach(function(row) { %>
                            <tr>
                                <td><%= row.reader_name %></td>
                                <td><%= row.chapter_count %></td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>

                <h2>User Chapters</h2>
                <table border="1">
                    <thead>
                        <tr>
                            <th>User Name</th>
                            <th>Reader Name</th>
                            <th>Family Name</th>
                            <th>Chapter Name</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% chapterRows.forEach(function(row) { %>
                            <tr>
                                <td><%= row.user_name %></td>
                                <td><%= row.reader_name %></td>
                                <td><%= row.family_name %></td>
                                <td><%= row.chapter_name %></td>
                                <td><%= row.timestamp %></td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            <% } else { %>
                <h1>Welcome to the Reading Tracker App!</h1>
                <p>Please <a href="/login">log in</a> to track your reading progress.</p>
            <% } %>
            

            <!-- Modal for Bible Progress -->
            <div id="bibleProgressModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <div id="bibleProgressContainer">
                        <!-- Bible progress content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <div id="sidebar">
            <% if (isLoggedIn) { %>
                <h2>Welcome, <%= userName %>!</h2>
                <a href="/record">Record a Chapter</a>
                <a href="/manage">Manage Family</a>
                <a href="/logout">Logout</a>
            <% } else { %>
                <a href="/login">Login</a>
            <% } %>
        </div>
        <!-- JavaScript for Modal -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var modal = document.getElementById('bibleProgressModal');
            var modalContent = document.getElementById('bibleProgressContainer');
            var closeBtn = document.getElementsByClassName('close')[0];
            var openLink = document.getElementById('openBibleProgress');

            // When the user clicks on the Bible Progress link, open the modal
            openLink.addEventListener('click', function(e) {
                e.preventDefault();
                // Fetch the Bible progress content dynamically
                fetch('/bible-progress')
                    .then(response => response.text())
                    .then(data => {
                        modalContent.innerHTML = data; // Inject content into the modal
                        modal.style.display = 'block'; // Show the modal
                    })
                    .catch(error => console.error('Error loading Bible progress:', error));
            });

            // When the user clicks on the close button, close the modal
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });

            // When the user clicks anywhere outside the modal, close it
            window.addEventListener('click', function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        });
    </script>
    </div>
</body>
</html>
